(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[22],{"1a13":function(t,o,a){"use strict";a.r(o);var e=function(){var t=this,o=t.$createElement,a=t._self._c||o;return a("div",[a("q-table",{attrs:{title:"Contactos del estudio",data:t.contactos,columns:"contactos"===t.ver?t.columnas:t.columnasMediadores,"row-key":"contacto",loading:t.loading,"rows-per-page-options":[25],"hide-pagination":""},scopedSlots:t._u([{key:"top-right",fn:function(){return[a("div",{staticClass:"row"},[a("div",{staticClass:"column",staticStyle:{"margin-right":"20px"}},[a("q-radio",{attrs:{val:"contactos",label:"Contactos"},model:{value:t.ver,callback:function(o){t.ver=o},expression:"ver"}}),a("q-radio",{attrs:{val:"mediadores",label:"Mediadores"},model:{value:t.ver,callback:function(o){t.ver=o},expression:"ver"}})],1),"contactos"===t.ver?a("q-select",{staticClass:"self-end",attrs:{label:"Tipo",options:t.opcionesTipo},on:{input:function(o){return t.update(1)}},model:{value:t.Tipo,callback:function(o){t.Tipo=o},expression:"Tipo"}}):t._e(),a("q-input",{staticClass:"self-end",staticStyle:{"margin-left":"7px"},attrs:{dense:"",debounce:"300",placeholder:"Buscar"},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.filter,callback:function(o){t.filter=o},expression:"filter"}}),a("q-btn",{staticStyle:{"margin-right":"7px"},attrs:{color:"primary self-center",round:"",size:"l"},on:{click:function(o){t.modalContacto=!0}}},[t._v("\n          +\n          "),a("q-tooltip",[t._v("\n            Agregar "+t._s("contactos"===t.ver?"Contacto":"Mediador")+"\n          ")])],1)],1)]},proxy:!0},{key:"body",fn:function(o){return[a("q-tr",{attrs:{props:o}},[a("q-td",{key:"contacto",attrs:{props:o}},[t._v("\n          "+t._s(o.row.Contacto)+"\n        ")]),a("q-td",{key:"telefono",attrs:{props:o}},[t._v("\n          "+t._s(o.row.Telefono)+"\n        ")]),a("q-td",{key:"email",attrs:{props:o}},[t._v("\n          "+t._s(o.row.Email)+"\n        ")]),"mediadores"===t.ver?a("q-td",{key:"registro",attrs:{props:o}},[t._v("\n          "+t._s(o.row.Registro)+"\n        ")]):t._e(),"mediadores"===t.ver?a("q-td",{key:"mp",attrs:{props:o}},[t._v("\n          "+t._s(o.row.MP)+"\n        ")]):t._e(),"contactos"===t.ver?a("q-td",{key:"tipo",attrs:{props:o}},[t._v("\n          "+t._s(t.tipoContacto(o.row.Tipo))+"\n        ")]):t._e(),a("q-td",{key:"Acciones",attrs:{props:o}},[a("q-icon",{staticStyle:{cursor:"pointer"},attrs:{name:"chat",size:"xs",color:"primary"},on:{click:function(a){"contactos"===t.ver?t.abrirChatContacto(o.row):t.abrirChatMediador(o.row)}}},[a("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10]}},[a("span",{staticClass:"text-body2"},[t._v("Ir al chat")])])],1),a("q-icon",{staticStyle:{cursor:"pointer","margin-left":"5px"},attrs:{name:"edit",size:"xs",color:"primary"},on:{click:function(a){return t.habilitarEdicion(o.row)}}},[a("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10]}},[a("span",{staticClass:"text-body2"},[t._v(t._s(o.row.IdContacto?"Editar contacto":"Editar mediador"))])])],1),a("q-icon",{staticStyle:{cursor:"pointer","margin-left":"5px"},attrs:{name:"clear",size:"xs",color:"red"},on:{click:function(a){t.modalEliminar=!0,t.idEliminar=o.row.IdContacto}}},[a("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10]}},[a("span",{staticClass:"text-body2"},[t._v("Eliminar")])])],1)],1)],1)]}},{key:"bottom",fn:function(){return[a("div",{staticClass:"justify-center",staticStyle:{width:"100%"}},[a("div",{staticClass:"row justify-center"},[a("q-pagination",{attrs:{color:"grey-8",max:t.pagesNumber,size:"sm"},on:{input:t.update},model:{value:t.page,callback:function(o){t.page=o},expression:"page"}})],1)])]},proxy:!0}])}),a("q-dialog",{model:{value:t.modalContacto,callback:function(o){t.modalContacto=o},expression:"modalContacto"}},[a("ModalContacto",{attrs:{editar:t.editar,datosEditar:t.datosEditar,mediador:"mediadores"===t.ver},on:{altaContacto:t.altaContacto,editarContacto:t.editarContacto,cerrar:t.cerrarModal}})],1),a("q-dialog",{attrs:{"prevent-close":""},model:{value:t.modalEliminar,callback:function(o){t.modalEliminar=o},expression:"modalEliminar"}},[a("q-card",{staticStyle:{padding:"1rem"}},[a("div",{staticStyle:{"text-align":"center"}},[a("span",[a("p",[t._v("\n            ¿Esta seguro que desea eliminar este contacto?\n            "),a("br"),t._v("\n            Esta accion es permanente.\n          ")])]),a("div",{staticStyle:{display:"flex","justify-content":"center","margin-botton":"2rem"}},[a("q-btn",{staticStyle:{"padding-top":"0px",float:"center","margin-right":"10px"},attrs:{color:"negative",label:"Eliminar"},on:{click:function(o){return t.eliminarContacto()}}}),a("q-btn",{staticStyle:{"padding-top":"0px",float:"center"},attrs:{color:"primary",label:"Cancelar"},on:{click:function(o){t.modalEliminar=!1}}})],1)])])],1)],1)},n=[],r=(a("20d6"),a("8daa")),i=a("2a19"),c=a("3b16"),l=a("3786"),s=a("fde3"),d={components:{ModalContacto:s["a"],QPagination:c["a"],QRadio:l["a"]},data:function(){return{loading:!0,modalEliminar:!1,idElminar:0,modalContacto:!1,editar:!1,datosEditar:{},ver:"contactos",contactos:[],rows:25,page:1,filter:"",Tipo:{label:"Todos",value:""},opcionesTipo:[{label:"Todos",value:""},{label:"Abogado",value:"A"},{label:"Medico",value:"M"},{label:"Proveedor",value:"P"},{label:"Otros",value:"O"}],columnas:[{name:"contacto",required:!0,label:"Contacto",align:"left",sortable:!0},{name:"telefono",required:!0,label:"Telefono",align:"left",sortable:!0},{name:"email",required:!0,label:"Email",align:"left",sortable:!0},{name:"tipo",required:!0,label:"Tipo",align:"left",sortable:!0},{name:"Acciones",required:!0,label:"Acciones",align:"left",sortable:!0}],columnasMediadores:[{name:"contacto",required:!0,label:"Contacto",align:"left",sortable:!0},{name:"telefono",required:!0,label:"Telefono",align:"left",sortable:!0},{name:"email",required:!0,label:"Email",align:"left",sortable:!0},{name:"registro",required:!0,label:"Registro",align:"left",sortable:!0},{name:"mp",required:!0,label:"MP",align:"left",sortable:!0},{name:"Acciones",required:!0,label:"Acciones",align:"left",sortable:!0}]}},created:function(){var t=this;r["a"].Get("/contactos/buscar-contacto",{offset:0,limit:25},(function(o){if(o.Error)i["a"].create(o.Error);else{var a=o.map((function(t){return{IdContacto:t.IdContacto,Contacto:t.Apellidos+", "+t.Nombres,Telefono:t.Telefono,Email:t.Email,Tipo:t.Tipo,IdChat:t.IdChatContacto}}));t.contactos=a,t.loading=!1}})),r["a"].Get("/contactos/contar-contactos",{},(function(o){o.Error?i["a"].create(o.Error):t.rows=o}))},computed:{pagesNumber:function(){return Math.ceil(parseInt(this.rows)/25)}},watch:{filter:function(){(this.filter.length>=4||""===this.filter)&&(this.contactos=[],this.page=1,this.update(1))},ver:function(){this.contactos=[],this.page=1,this.filter="",this.update(1)}},methods:{update:function(t){var o=this,a=25*(t-1),e=this.filter.length>=4?this.filter:"",n=this.Tipo.value;this.loading=!0,"contactos"===this.ver?(r["a"].Get("/contactos/buscar-contacto",{offset:a,limit:25,cadena:e,tipo:n},(function(t){if(t.Error)i["a"].create(t.Error);else{var a=t.map((function(t){return{IdContacto:t.IdContacto,Contacto:t.Apellidos+", "+t.Nombres,Telefono:t.Telefono,Email:t.Email,Tipo:t.Tipo,IdChat:t.IdChatContacto}}));o.contactos=a,o.loading=!1}})),r["a"].Get("/contactos/contar-contactos",{Cadena:e,Tipo:n},(function(t){t.Error?i["a"].create(t.Error):o.rows=t}))):(r["a"].Get("/mediaciones/mediadores",{offset:a,limit:25,cadena:e},(function(t){if(t.Error)i["a"].create(t.Error);else{var a=t.map((function(t){return{IdContacto:t.IdMediador,IdChat:t.IdChatMediador,Contacto:t.Nombre,Telefono:t.Telefono,Email:t.Email,Tipo:t.Tipo,MP:t.MP,Registro:t.Registro}}));o.contactos=a,o.loading=!1}})),r["a"].Get("/mediadores/contar-mediadores",{Cadena:e},(function(t){t.Error?i["a"].create(t.Error):o.rows=t})))},habilitarEdicion:function(t){this.datosEditar=t,this.editar=!0,this.modalContacto=!0},editarContacto:function(t){var o=this;this.loading=!0,setTimeout((function(){o.loading=!1}),300);var a="contactos"===this.ver?t.Apellidos+", "+t.Nombres:t.Nombres,e={Contacto:a,IdContacto:t.IdContacto,Registro:t.Registro,MP:t.MP,Telefono:t.Telefono,Email:t.Email,Tipo:t.Tipo},n=this.contactos.findIndex((function(t){return parseInt(t.IdContacto)===parseInt(e.IdContacto)}));this.contactos[n]=e,this.contactos=this.contactos.sort((function(t,o){return t.Contacto.toLowerCase()>o.Contacto.toLowerCase()?1:t.Contacto.toLowerCase()<o.Contacto.toLowerCase()?-1:0})),this.modalContacto=!1},altaContacto:function(t){var o="contactos"===this.ver?t.Apellidos+", "+t.Nombres:t.Nombres,a={Contacto:o,IdContacto:t.IdContacto,Registro:t.Registro,MP:t.MP,Telefono:t.Telefono,Email:t.Email,Tipo:t.Tipo};this.contactos.push(a),this.contactos=this.contactos.sort((function(t,o){return t.Contacto.toLowerCase()>o.Contacto.toLowerCase()?1:t.Contacto.toLowerCase()<o.Contacto.toLowerCase()?-1:0})),this.contactos.length>25&&this.contactos.pop(),this.modalContacto=!1},eliminarContacto:function(){var t=this;this.modalEliminar=!1,"contactos"===this.ver?r["a"].Post("/contactos/borrar-contacto",{IdContacto:this.idEliminar},(function(o){o.Error?i["a"].create(o.Error):(1===t.contactos.length?(1===t.page?t.contactos.pop():t.update(t.page-1),t.page=t.page-1):t.update(t.page),t.idEliminar=0,i["a"].create("Se elimino el contacto correctamente."))})):r["a"].Post("/mediadores/borrar-contacto",{IdMediador:this.idEliminar},(function(o){o.Error?i["a"].create(o.Error):(1===t.contactos.length?(1===t.page?t.contactos.pop():t.update(t.page-1),t.page=t.page-1):t.update(t.page),t.idEliminar=0,i["a"].create("Se elimino el contacto correctamente."))}))},cerrarModal:function(){this.datosEditar={},this.editar=!1,this.modalContacto=!1},abrirChatMediador:function(t){var o=this;if(console.log(t),t.IdChat){var a=this.$router.resolve({name:"Chat",query:{id:t.IdChat,caratula:t.Contacto,telefono:t.Telefono,idMediacion:t.IdContacto}});window.open(a.href,"_blank")}else{var e={Telefono:t.Telefono,IdMediador:t.IdContacto};r["a"].Post("/chats/crear",e,(function(a){if(a.Error)i["a"].create("Falló al iniciar un nuevo chat. Razon: "+a.Error);else{i["a"].create("Nuevo chat con mediador creado!");var e=o.contactos.findIndex((function(o){return o.IdContacto===t.IdContacto}));o.contactos[e].IdChat=a.IdChat;var n=o.$router.resolve({name:"Chat",query:{id:a.IdChat,caratula:t.Contacto,telefono:t.Telefono,idMediacion:t.IdContacto}});window.open(n.href,"_blank")}}))}},abrirChatContacto:function(t){var o=this;if(console.log(t),t.IdChat){var a=this.$router.resolve({name:"Chat",query:{id:t.IdChat,caratula:t.Contacto,telefono:t.Telefono,idContacto:t.IdContacto}});window.open(a.href,"_blank")}else{var e={Telefono:t.Telefono,IdContacto:t.IdContacto};r["a"].Post("/chats/crear",e,(function(a){if(a.Error)i["a"].create("Falló al iniciar un nuevo chat. Razon: "+a.Error);else{i["a"].create("Nuevo chat con contacto creado!");var e=o.contactos.findIndex((function(o){return o.IdContacto===t.IdContacto}));o.contactos[e].IdChat=a.IdChat;var n=o.$router.resolve({name:"Chat",query:{id:a.IdChat,caratula:t.Contacto,telefono:t.Telefono,idContacto:t.IdContacto}});window.open(n.href,"_blank")}}))}},tipoContacto:function(t){switch(t){case"A":return"Abogado";case"M":return"Medico";case"P":return"Proveedor";default:return"Otros"}}}},u=d,p=a("2877"),f=Object(p["a"])(u,e,n,!1,null,null,null);o["default"]=f.exports}}]);