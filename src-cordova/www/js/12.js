(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{"1e1e":function(a,i,t){},4795:function(a,i,t){"use strict";var e=t("1e1e"),o=t.n(e);o.a},ab55:function(a,i,t){"use strict";t.r(i);var e=function(){var a=this,i=a.$createElement,t=a._self._c||i;return t("div",{staticClass:"full_container"},[t("div",{staticClass:"chat_container"},[t("q-item",{staticClass:"header_container",style:a.idMediacion||a.idContacto?"":"cursor: pointer",nativeOn:{click:function(i){return a.abrirCaso()}}},[t("span",{staticClass:"text-black",staticStyle:{"text-align":"center"}},[a._v("\n        "+a._s(a.idMediacion?"Mediador: ":a.idContacto?"Contacto: ":"Caso: ")+"\n        "),t("span",{staticClass:"text-weight-bold text-black"},[a._v("\n          "+a._s(a.caratula?a.caratula:"Sin carátula")+"\n        ")]),t("br"),a._v("\n        Telefono:\n        "),t("span",{staticClass:"text-weight-bold text-black"},[a._v("\n          "+a._s(a.telefono)+"\n        ")])]),a.IdCaso?t("q-tooltip",[a._v("Ir al caso")]):a._e()],1),t("div",{staticClass:"mensajes_container",attrs:{id:"scrollDiv"}},a._l(a.mensajes,(function(i,e){return t("q-chat-message",{key:e,attrs:{text:a.esArchivo(i.Contenido)?[]:[i.Contenido],stamp:i.FechaEnviado,"bg-color":i.IdUsuario?"primary":"pink-4",sent:!!i.IdUsuario,size:"5","text-color":"white"},scopedSlots:a._u([a.esArchivo(i.Contenido)?{key:"default",fn:function(){return["A"===a.tipoArchivo(i.Contenido)?t("audio",{attrs:{controls:""}},[t("source",{attrs:{src:i.Contenido}})]):"V"===a.tipoArchivo(i.Contenido)?t("video",{staticClass:"img--multimedia",attrs:{src:i.Contenido,controls:""}}):"I"===a.tipoArchivo(i.Contenido)?t("img",{staticClass:"img--multimedia",attrs:{src:i.Contenido}}):t("span",[a._v("Formato Desconocido")]),t("br"),t("a",{staticClass:"self-bottom",attrs:{href:i.Contenido,download:"ArchivoCaso-"+a.caratula,target:"_blank"}},[a._v("\n            Descargar\n          ")])]},proxy:!0}:null],null,!0)})})),1),t("div",{staticClass:"input_container"},[t("div",{staticClass:"row"},[t("q-checkbox",{staticClass:"q-pr-md q-pl-lg",attrs:{label:"Mostrar nombre en el mensaje"},model:{value:a.enviarUsuario,callback:function(i){a.enviarUsuario=i},expression:"enviarUsuario"}}),t("div",{staticClass:"col-12"},[t("q-input",{staticClass:"q-pr-md q-pl-lg",attrs:{filled:"",type:"textarea",rows:"1",placeholder:"Escriba su mensaje aqui..."},scopedSlots:a._u([{key:"after",fn:function(){return[t("q-btn",{staticClass:"send_btn",staticStyle:{transform:"rotate(-45deg)"},attrs:{round:"",flat:"",icon:"attach_file"}},[t("q-tooltip",[a._v("Enviar Archivo")]),t("q-popup-proxy",{staticStyle:{width:"300px",height:"300px"},on:{show:function(i){return a.upload()}}},[t("q-item",{staticClass:"items-center",staticStyle:{width:"300px",height:"100%"}},[0===a.Multimedia.length?t("q-uploader",{ref:"uploader",staticStyle:{width:"100%","margin-top":"10px"},attrs:{"auto-upload":"","max-files":"1",factory:a.factoryFn},on:{uploaded:a.uploadedFile,removed:a.removedFile}}):t("div",{staticClass:"items-center",staticStyle:{position:"relative",width:"300px"}},[t("span",[a._v(a._s(a.archivo.nombre))]),t("q-btn",{staticStyle:{position:"absolute",top:"0px",right:"0px"},attrs:{color:"negative",round:"",size:"xs"},on:{click:function(i){return a.Multimedia.splice(0)}}},[a._v("\n                        X\n                      ")]),t("br"),a.archivo.srcImg?t("img",{staticClass:"img--multimedia--enviado",attrs:{src:a.archivo.srcImg}}):a._e()],1)],1)],1)],1),a.checkMensajesDefault?t("q-btn",{staticClass:"send_btn",attrs:{round:"",flat:"",icon:"message"}},[t("q-tooltip",[a._v("Mensajes predeterminados")]),t("q-popup-proxy",[a.idMediacion&&a.fechasMediacionMensaje?t("q-item",{staticStyle:{"align-items":"center","justify-content":"center"},attrs:{clickable:""},on:{click:function(i){a.inputMessage=a.fechasMediacionMensaje}}},[a._v("\n                    Listar Fechas de Mediacion\n                  ")]):a._e(),t("q-separator"),t("q-item",[t("Select",{attrs:{multiple:!1,label:"Buscar Mensaje",hint:"Seleccione un Mensaje",tooltip:!0,opciones:a.opcionesMensajes},on:{seleccion:a.mensajeSeleccionado}})],1)],1)],1):a._e(),t("q-btn",{staticClass:"send_btn",attrs:{round:"",flat:"",icon:"send"},on:{click:function(i){return a.send()}}},[t("q-tooltip",[a._v("Enviar")])],1)]},proxy:!0}]),model:{value:a.inputMessage,callback:function(i){a.inputMessage=i},expression:"inputMessage"}})],1)],1)])],1)])},o=[],n=(t("7f7f"),t("a481"),t("6762"),t("2fdb"),t("28a5"),t("8daa")),s=t("b628"),c=t("a6d8"),r=t("2a19"),p={name:"Chat",components:{Select:c["a"]},data:function(){return{IdCaso:0,inputMessage:"",loading:!1,caratula:"",telefono:"",idChat:0,idMediacion:0,idContacto:0,idExternoChat:0,mensajes:[],idUltimoMensaje:0,timerMensajes:"",notificaciones:[],checkMensajesDefault:!1,opcionesMensajes:[],Multimedia:[],fechasMediacionMensaje:"",archivo:{nombre:"",srcImg:""},enviarUsuario:!0,NombreUsuario:""}},created:function(){var a=this;if(this.$route.query.id){var i=s["a"].UsuarioLogueado;this.NombreUsuario=i.Apellidos+", "+i.Nombres,this.caratula=this.$route.query.caratula,this.telefono=this.$route.query.telefono,this.idChat=this.$route.query.id,this.idMediacion=this.$route.query.idMediacion?this.$route.query.idMediacion:null,this.idContacto=this.$route.query.idContacto?this.$route.query.idContacto:null,n["a"].Get("/estudios/".concat(s["a"].UsuarioLogueado.IdEstudio,"/mensajes-estudio"),{},(function(i){i.length>0&&(a.checkMensajesDefault=!0,a.opcionesMensajes=i.map((function(a){return{label:a.Titulo,value:a.MensajeEstudio,tooltip:a.MensajeEstudio}})))})),n["a"].Get("/mediaciones/fechas",{},(function(i){i.length>0&&(a.fechasMediacionMensaje="El estudio tiene las siguientes fechas ocupadas por audiencias de mediación:\n",i.forEach((function(t,e){a.fechasMediacionMensaje+=t.FechaProximaAudiencia.slice(0,-3),e!==i.length&&(a.fechasMediacionMensaje+="\n")})))})),this.idMediacion||this.idContacto||n["a"].Get("/chats/".concat(this.idChat),{},(function(i){i.Error?r["a"].create("No se pudieron obtener los datos del chat."):a.IdCaso=i.IdCaso})),this.setEnterEvent(),this.verificarChat()}else this.$router.push("/GrillaCasos")},mounted:function(){var a=this;this.goToBottom();var i=document.querySelector("div.mensajes_container"),t={attributes:!0,childList:!0,characterData:!0},e=new MutationObserver((function(i){i.forEach((function(i){i.addedNodes.length&&a.goToBottom()}))}));e.observe(i,t)},methods:{tipoArchivo:function(a){var i=a.split(".").reverse()[0],t=JSON.parse('{"png":["image/png","image/x-png"],"bmp":["image/bmp","image/x-bmp","image/x-bitmap","image/x-xbitmap","image/x-win-bitmap","image/x-windows-bmp","image/ms-bmp","image/x-ms-bmp","application/bmp","application/x-bmp","application/x-win-bitmap"],"gif":["image/gif"],"jpeg":["image/jpeg","image/pjpeg"],"xspf":["application/xspf+xml"],"vlc":["application/videolan"],"wmv":["video/x-ms-wmv","video/x-ms-asf"],"au":["audio/x-au"],"ac3":["audio/ac3"],"flac":["audio/x-flac"],"ogg":["audio/ogg","video/ogg","application/ogg"],"oga":["audio/ogg","video/ogg","application/ogg"],"kmz":["application/vnd.google-earth.kmz"],"kml":["application/vnd.google-earth.kml+xml"],"rtx":["text/richtext"],"rtf":["text/rtf"],"jar":["application/java-archive","application/x-java-application","application/x-jar"],"zip":["application/x-zip","application/zip","application/x-zip-compressed","application/s-compressed","multipart/x-zip"],"7zip":["application/x-compressed"],"xml":["application/xml","text/xml"],"svg":["image/svg+xml"],"3g2":["video/3gpp2"],"3gp":["video/3gp","video/3gpp"],"mp4":["video/mp4"],"m4a":["audio/x-m4a"],"f4v":["video/x-f4v"],"flv":["video/x-flv"],"webm":["video/webm"],"aac":["audio/x-acc"],"m4u":["application/vnd.mpegurl"],"pdf":["application/pdf","application/octet-stream"],"pptx":["application/vnd.openxmlformats-officedocument.presentationml.presentation"],"ppt":["application/powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-office","application/msword"],"docx":["application/vnd.openxmlformats-officedocument.wordprocessingml.document"],"xlsx":["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"],"xl":["application/excel"],"xls":["application/msexcel","application/x-msexcel","application/x-ms-excel","application/x-excel","application/x-dos_ms_excel","application/xls","application/x-xls"],"xsl":["text/xsl"],"mpeg":["video/mpeg"],"mov":["video/quicktime"],"avi":["video/x-msvideo","video/msvideo","video/avi","application/x-troff-msvideo"],"movie":["video/x-sgi-movie"],"log":["text/x-log"],"txt":["text/plain"],"css":["text/css"],"html":["text/html"],"wav":["audio/x-wav","audio/wave","audio/wav"],"xhtml":["application/xhtml+xml"],"tar":["application/x-tar"],"tgz":["application/x-gzip-compressed"],"psd":["application/x-photoshop","image/vnd.adobe.photoshop"],"exe":["application/x-msdownload"],"js":["application/x-javascript"],"mp3":["audio/mpeg","audio/mpg","audio/mpeg3","audio/mp3"],"rar":["application/x-rar","application/rar","application/x-rar-compressed"],"gzip":["application/x-gzip"],"hqx":["application/mac-binhex40","application/mac-binhex","application/x-binhex40","application/x-mac-binhex40"],"cpt":["application/mac-compactpro"],"bin":["application/macbinary","application/mac-binary","application/x-binary","application/x-macbinary"],"oda":["application/oda"],"ai":["application/postscript"],"smil":["application/smil"],"mif":["application/vnd.mif"],"wbxml":["application/wbxml"],"wmlc":["application/wmlc"],"dcr":["application/x-director"],"dvi":["application/x-dvi"],"gtar":["application/x-gtar"],"php":["application/x-httpd-php","application/php","application/x-php","text/php","text/x-php","application/x-httpd-php-source"],"swf":["application/x-shockwave-flash"],"sit":["application/x-stuffit"],"z":["application/x-compress"],"mid":["audio/midi"],"aif":["audio/x-aiff","audio/aiff"],"ram":["audio/x-pn-realaudio"],"rpm":["audio/x-pn-realaudio-plugin"],"ra":["audio/x-realaudio"],"rv":["video/vnd.rn-realvideo"],"jp2":["image/jp2","video/mj2","image/jpx","image/jpm"],"tiff":["image/tiff"],"eml":["message/rfc822"],"pem":["application/x-x509-user-cert","application/x-pem-file"],"p10":["application/x-pkcs10","application/pkcs10"],"p12":["application/x-pkcs12"],"p7a":["application/x-pkcs7-signature"],"p7c":["application/pkcs7-mime","application/x-pkcs7-mime"],"p7r":["application/x-pkcs7-certreqresp"],"p7s":["application/pkcs7-signature"],"crt":["application/x-x509-ca-cert","application/pkix-cert"],"crl":["application/pkix-crl","application/pkcs-crl"],"pgp":["application/pgp"],"gpg":["application/gpg-keys"],"rsa":["application/x-pkcs7"],"ics":["text/calendar"],"zsh":["text/x-scriptzsh"],"cdr":["application/cdr","application/coreldraw","application/x-cdr","application/x-coreldraw","image/cdr","image/x-cdr","zz-application/zz-winassoc-cdr"],"wma":["audio/x-ms-wma"],"vcf":["text/x-vcard"],"srt":["text/srt"],"vtt":["text/vtt"],"ico":["image/x-icon","image/x-ico","image/vnd.microsoft.icon"],"csv":["text/x-comma-separated-values","text/comma-separated-values","application/vnd.msexcel"],"json":["application/json","text/json"]}'),e=t[i][0];return e?e.includes("application")?"O":e.substring(0,1).toUpperCase():"O"},mensajeSeleccionado:function(a){this.inputMessage=a.value},verificarChat:function(){var a=this;if(sessionStorage.getItem(this.idChat)){var i=JSON.parse(sessionStorage.getItem(this.idChat));this.mensajes=i,this.idUltimoMensaje=i[i.length-1].IdMensaje}else n["a"].Get("/mensajes/".concat(this.idChat),{IdUltimoMensaje:null,mediador:this.idMediacion,contacto:this.idContacto},(function(i){i.Error?r["a"].create(i.Error):i.length?(i.reverse(),a.mensajes=i,a.IdCaso&&sessionStorage.setItem(a.idChat,JSON.stringify(i)),a.idUltimoMensaje=i[i.length-1].IdMensaje):console.log("Primera respuesta vacía")}));localStorage.intervalChat&&clearInterval(localStorage.intervalChat),localStorage.intervalChat=setInterval(this.buscarMensajes,2e3)},buscarMensajes:function(){var a=this;"/Chat/"===this.$route.path.slice(0,5)||"/Chat"===this.$route.path.slice(0,5)?n["a"].Get("/mensajes/".concat(this.idChat),{IdUltimoMensaje:this.idUltimoMensaje,Limit:20,mediador:this.idMediacion,contacto:this.idContacto},(function(i){if(i.Error)console.log("Error en el loop.");else if(console.log("Request de mensajes exitoso.",a.idUltimoMensaje),i.length){i.reverse(),console.log("Respuesta contiene mensajes...");var t=sessionStorage.getItem(a.idChat)?JSON.parse(sessionStorage.getItem(a.idChat)):[];i.forEach((function(i){i.IdUsuario||a.mensajes.push(i),t.push(i)})),sessionStorage.setItem(a.idChat,JSON.stringify(t)),a.idUltimoMensaje=i[i.length-1].IdMensaje,n["a"].Post("/chats/".concat(a.idChat,"/actualizar"),{IdUltimoLeido:a.idUltimoMensaje,mediador:a.idMediacion,contacto:a.idContacto},(function(a){a.Error?r["a"].create(a.Error):console.log("UltimoMensajeLeido actualizado correctamente.")}))}else console.log("Respuesta vacía")})):clearInterval(localStorage.intervalChat)},send:function(){var a=this;if(""!==this.inputMessage||this.Multimedia.length>0){this.inputMessage=this.inputMessage.replace(/\r?\n/g,"<br>"),this.enviarUsuario&&(this.inputMessage="".concat(this.inputMessage,"<br>- Enviado por ").concat(this.NombreUsuario));var i={IdUsuario:!0,Contenido:this.inputMessage?this.inputMessage:"Archivo enviado",FechaEnviado:this.currentDateTime()};this.Multimedia.length>0&&this.mensajes.push({IdUsuario:!0,Contenido:"https://io.docdoc.com.ar/api/multimedia?file=".concat(this.Multimedia[0].URL),FechaEnviado:this.currentDateTime()}),this.mensajes.push(i);var t={IdChat:this.idChat,Contenido:this.inputMessage,Multimedia:JSON.stringify(this.Multimedia),IdCaso:this.IdCaso,mediador:this.idMediacion,contacto:this.idContacto};this.inputMessage="",n["a"].Post("/mensajes/enviar",t,(function(i){i.Error?r["a"].create(i.Error):(console.log("Mensaje enviado correctamente!"),a.idUltimoMensaje=i.IdMensaje,a.Multimedia.splice(0),n["a"].Post("/chats/".concat(a.idChat,"/actualizar"),{IdUltimoLeido:a.idUltimoMensaje,mediador:a.idMediacion,contacto:a.idContacto},(function(a){a.Error?r["a"].create(a.Error):console.log("UltimoMensajeLeido actualizado correctamente.")})))}))}},currentDateTime:function(){var a=new Date,i="".concat(a.getFullYear(),"-").concat(a.getMonth()+1,"-").concat(a.getDate()),t="".concat(a.getHours(),":").concat(a.getMinutes());return"".concat(i," - ").concat(t)},goToBottom:function(){var a=document.getElementById("scrollDiv");a.scrollTop=a.scrollHeight-a.clientHeight},setEnterEvent:function(){var a=this;document.body.addEventListener("keydown",(function(i){"Enter"===i.key&&(i.preventDefault(),a.send())}))},esArchivo:function(a){var i=a.includes("wasabisys")||a.includes("https://io.docdoc.com.ar/api/multimedia?file=");return!!i},upload:function(){this.$refs.uploader.pickFiles()},factoryFn:function(){return{url:"https://io.docdoc.com.ar/api/multimedia",method:"POST",headers:[{name:"Authorization",value:"Bearer ".concat(s["a"].Token)}]}},uploadedFile:function(a){var i=a.files,t=a.xhr;this.archivo.nombre=i[0].name,this.archivo.srcImg=i[0].__img?i[0].__img.currentSrc:"";for(var e=JSON.parse(t.response),o=0;o<i.length;o++){var n=i[o].type;this.Multimedia.push({URL:e.Urls[0],Nombre:e.Names[0],Tipo:n.includes("application")?"O":n.substring(0,1).toUpperCase(),OrigenMultimedia:"R"})}},removedFile:function(a){for(var i=0;i<a.length;i++)for(var t=a[i],e=JSON.parse(t.xhr.response),o=0;o<this.Multimedia.length;o++)this.Multimedia[o].Url===e.Urls[0]&&this.Multimedia.splice(o,1)},abrirCaso:function(){this.IdCaso&&this.$router.push({name:"Caso",query:{id:this.IdCaso}})}}},l=p,d=(t("4795"),t("2877")),m=Object(d["a"])(l,e,o,!1,null,"a90b5882",null);i["default"]=m.exports}}]);